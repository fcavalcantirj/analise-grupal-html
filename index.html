<!doctype html>
<html class="no-js" lang="pt">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Analise Grupal</title>
  <link rel="stylesheet" href="css/style.css">
  <meta name="description" content="Ferramenta open-source para an√°lise de grupos">
  <meta name="keywords" content="An√°lise Grupal, WhatsApp chat analysis, an√°lise de conversas, privacidade em an√°lise de dados, estat√≠sticas de grupo WhatsApp, an√°lise de sentimentos, an√°lise de texto WhatsApp, visualiza√ß√£o de dados de chat, frequ√™ncia de mensagens, heatmap de conversas, an√°lise de t√≥picos de chat, cloud de palavras WhatsApp, privacidade de dados, open-source, an√°lise de chat sem armazenamento, an√°lise de conversa grupal, tend√™ncias de comunica√ß√£o WhatsApp, an√°lise de grupo">
  <meta property="og:title" content="Sobre o Analise Grupal">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://www.analisegrupal.com.br">
  <meta property="og:image" content="https://analisegrupal.com.br/img/analise_grupal_logo.png">

  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" href="/icon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="icon.png">

  <link rel="manifest" href="site.webmanifest">
  <meta name="theme-color" content="#fafafa">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Lobster'>
  <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        body {
            background-color: #72684F;
            font-family: Arial, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;

            font-family: 'Roboto', sans-serif; /* New font */
/*            background: #f4f4f4; /* Lighter background */*/
            color: #333; /* Dark grey text for better readability */
        }

        h1 {
              color: #333;
              margin-bottom: 2rem;
              font-size: 2rem;
        }

        form {
            background-color: #FFF;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 480px;

            border: 1px solid #e0e0e0; /* Light border */
        }

        img {
            max-width: 100%; /* ensures images are responsive and don't overflow their container */
            height: auto;
        }

        #analysisResults {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #analysisResults > * {
            margin: 20px 0;
        }

      label {
          display: block;
          margin-bottom: 1rem;
          color: #555;
          font-weight: bold;
      }

      span {
          display: block;
          margin-bottom: 1rem;
          color: #555;
      }

      input[type="file"] {
          margin-bottom: 1.5rem;
          padding: 0.5rem;
          border: 1px solid #AAA;
          border-radius: 4px;
      }

      input[type="submit"] {
          color: #FFF;
          padding: 0.5rem 1rem;
          border: none;
          border-radius: 4px;
          cursor: pointer;

          background-color: #008cba; /* More modern button color */
          transition: background-color 0.3s ease, transform 0.3s ease; /* Smooth transitions */
      }

      input[type="submit"]:hover {
          background-color: #005f6b; /* Darker shade on hover */
          transform: translateY(-2px); /* Slight lift effect */
      }

      iframe {
          width: 100%;
          margin: 0;
          padding: 0;
          border: none;
      }

    /* Add media queries for responsiveness */
    @media (max-width: 768px) {
      form {
        width: 90%; /* Full width on smaller screens */
        margin: 0 auto; /* Center form */
      }
    }

    footer {
        margin-top: 2rem;
        text-align: center;
        width: 100%;
        margin-bottom: 1rem;
    }

    footer p {
        color: #aaa;
    }
    .content {
      display: flex;
      flex-flow: column;
      align-items: center;
      position: relative;
      transform: translate(-50%, -50%);
      padding: 1em;
    }
    .content .title {
      font: 5em Lobster, cursive;
      text-shadow: 0 2px 0 rgba(0,0,0,0.5);
      color: #fafafa;
      margin: -0.5em 0 0.5em 0;
    }
    .content canvas {
      background: #000000;
      box-shadow: 0 2px 16px rgba(0,0,0,0.25);
    }
    canvas#canvas {
      background-color: black;
      display: none; /* Only show it when the game starts */
      position: fixed; /* Fixed position makes it stay in place even when scrolling */
      top: 50%; /* Start at 50% from the top */
      left: 50%; /* Start at 50% from the left */
      transform: translate(-50%, -50%); /* This will truly center the canvas */
      z-index: 9999; /* This should be higher than any other z-index on your page */
    }
    </style>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7DTBLS7LPL"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      // Your Google Analytics ID
      gtag('config', 'G-7DTBLS7LPL');

      // Your Google Ads ID, for conversion tracking
      gtag('config', 'AW-11398970229');

      function trackEvent(action, category, label, value) {
          gtag('event', action, {
              'event_category': category,
              'event_label': label,
              'value': value
          });
      }
    </script>
</head>

<body>

  <!-- <h1>An√°lise Grupal BETA</h1> -->
  <img src="img/analise_grupal_logo.png">

  <form id="uploadForm" enctype="multipart/form-data" onsubmit="return submitForm();">
      <span>Clique <a href="https://tecnoblog.net/responde/whatsapp-salvar-historico-conversa/" target="_blank">aqui</a> para aprender a exportar o chat</span>
      <label for="file">Fa√ßa upload de um chat do whatsApp:</label>
      <input type="file" name="file" required id="file" accept=".txt,.zip">
      <input type="submit" value="Carregar e Analisar">
      <span style="margin-top: 2rem;">obs: <b>nenhum</b> dado √© armazenado!!!</span>
      <span>N√£o entendi nada!!! Clique <a href="about.html" onclick="trackEvent('about', 'AnaliseGrupal', 'about_clicked', 1);">aqui</a></span>
  </form>

  <div id="analysisResults"></div>

  <canvas id="canvas" width="640" height="480" style="z-index: 9999; display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);"></canvas>

  <script src="js/app.js"></script>
  <script>
      const endpoints = [
          '/whatsapp/message/avg_sentiment_per_person',
          '/whatsapp/message/sentiment_over_time',
          '/whatsapp/message/peak_response_time',
          '/whatsapp/message/activity_heatmap',
          '/whatsapp/message/user_activity_over_time',
          '/whatsapp/message/conversational_turns',
          '/whatsapp/message/active_days',
          '/whatsapp/message/topic_percentage',
          '/whatsapp/message/wordfrequency/25',
          '/whatsapp/message/wordcloud',
          '/whatsapp/message/lenghiest/top/10',
          '/whatsapp/message/sentiment/distribution',
          '/whatsapp/message/heatmap',
          '/whatsapp/message/usercount',
          // '/whatsapp/message/activeusers/10', redundant
          // '/whatsapp/message/topic_modeling' // not working
      ];

      const endpointTitles = {
          'message/avg_sentiment_per_person': 'Acima de 0 - palavras positivas | abaixo de 0 - negativas',
          'message/sentiment_over_time': 'Sentimento ao Longo do Tempo',
          'message/peak_response_time': 'Picos de mensagens por Usu√°rio por hora',
          'message/activity_heatmap': 'N√∫mero de mensagems X Hora do dia',
          'message/user_activity_over_time': 'Atividade dos Usu√°rios ao Longo do Tempo',
          'message/conversational_turns': 'Quem mais "puxa novos papos" e/ou "responde menos"',
          'message/active_days': 'N√∫mero de mensagens por dia da semana',
          'message/topic_percentage': 'Percentual de T√≥picos',
          'wordfrequency/25': 'Frequ√™ncia de Palavras que mais aparecem (Top 25)',
          'message/wordcloud': 'Nuvem de Palavras | WordCloud',
          'top/10': '10 usu√°rios que mandam as maiores mensagens',
          'sentiment/distribution': 'M√©dia de sentimento (LeIA/Vader sentiment analysis)',
          'message/heatmap': 'Mapa de calor | Mensagens enviadas por hora',
          'message/usercount': 'TOP 20 que mais enviam | BOTTOM 5 que menos enviam',
          'activeusers/10': 'TOP 10 Usu√°rios que mais enviam mensagens',
          // 'topic_modeling': 'Modelagem de T√≥picos' // n√£o est√° funcionando
      };

      const MAX_RETRIES = 3;
      const API_DOMAIN = 'https://api.analisegrupal.com.br'
      // const API_DOMAIN = 'http://localhost:5000'

      function shareOnWhatsApp(imageUrl, customMessage) {
          const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
          const encodedImageUrl = encodeURIComponent('----> ' + imageUrl);
          const encodedMessage = encodeURIComponent(customMessage);
          const whatsappUrl = isMobile ? `whatsapp://send?text=${encodedMessage}%20${encodedImageUrl}`
                                       : `https://web.whatsapp.com/send?text=${encodedMessage}%20${encodedImageUrl}`;
          trackEvent('share', 'WhatsApp', 'Content Share', 1);

          // Try to open a new window
          const newWindow = window.open(whatsappUrl, '_blank');
          
          // If a popup blocker prevents the new window, set the location of the current window
          if (!newWindow || newWindow.closed || typeof newWindow.closed === 'undefined') {
              window.location.href = whatsappUrl;
          }
      }

      function showSpinner(spinnerId) {
        console.log("showSpinner-id=[" + spinnerId + ']');
        try { 
          document.getElementById(spinnerId).style.display = 'block'
        } catch (err) { 
          console.log(err) 
        }
      }

      function hideSpinner(spinnerId) {
        console.log("hideSpinner-id=[" + spinnerId + ']');
        try { 
          document.getElementById(spinnerId).style.display = 'none'
        } catch (err) {
          console.log(err) 
        }      
      }

      function enableAllAnalyzeButtons() {
          for (let i = 1; ; i++) {
              const analyzeButton = document.getElementById(`analyze${i}`);
              if (!analyzeButton) break; // If the button doesn't exist, stop the loop
              analyzeButton.disabled = false;
          }
      }

      function uploadAndShare(imageId, spinnerId, text, analysisType, temperature, endGame) {
        console.log(imageId)
        console.log(spinnerId)
        trackEvent('share', 'WhatsApp', 'Content Share Try', 1);
        gtag('share', 'WhatsApp', {'send_to': 'AW-11398970229/w499CJ7ZufMYEPX2ubsq'});
        const imgElement = document.getElementById(imageId);
        fetch(imgElement.src)
          .then(res => res.blob())
          .then(blob => {
              validateImage(blob).then(validBlob => {
                  let formData = new FormData();
                  formData.append('image', validBlob);

                  fetch(API_DOMAIN + '/upload_to_imgur', {
                      method: 'POST',
                      body: formData
                  })
                  .then(response => response.json())
                  .then(data => {
                    if (endGame) {
                      end_game()
                    }
                    let _text;
                    if(text && analysisType && temperature) {
                      let model = `\n\nAn√°lise tipo:[${analysisType}]--temperatura:[${temperature}]`
                      _text = text
                      _text += model
                      _text += '\n\n\nüìäüßê Confira no https://analisegrupal.com.br/ #An√°liseGrupal'
                    } else {
                      _text = 'üöÄ Descubra as estat√≠sticas do nosso grupo do WhatsApp com esta an√°lise! '
                    }
                    if (data.link && _text) {
                        shareOnWhatsApp(data.link, _text, endGame);
                    } else {
                      // console.log(data)
                      const error = data.response.data.error
                      if(error) {
                        alert(error)
                      }
                      throw new Error('Imgur upload failed or no link returned.');
                    }
                  })
                  .catch(error => {
                    if (endGame) {
                      end_game()
                    }
                    console.error('Error uploading to Imgur or sharing on WhatsApp:', error);
                  });
              }).catch(error => {
                  if (endGame) {
                    end_game()
                  }
                  console.error('Invalid image for upload:', error);
              });
          });
      }

      function validateImage(blob) {
          return new Promise((resolve, reject) => {
              const imageUrl = URL.createObjectURL(blob);
              const img = new Image();
              img.onload = () => resolve(blob);  // If loading succeeds, the image is valid
              img.onerror = () => reject(new Error('Invalid image'));  // If there's an error, the image isn't valid
              img.src = imageUrl;
          });
      }

      function fetchData(endpoint, formData, retries = 0) {
            return fetch(API_DOMAIN + endpoint, {
              method: 'POST',
              body: formData
          })
          .then(response => {
              if (!response.ok && retries < MAX_RETRIES) {
                  return fetchData(endpoint, formData, retries + 1);
              } else if (!response.ok) {
                  throw new Error(`Failed after ${MAX_RETRIES} retries.`);
              }
              if(endpoint === '/whatsapp/message/topic_modeling') {
                  return response.text()
              } else {
                  return response.blob()
              }
          });
      }

      function createButtonSet(imageSrc, text, index, type) {
        const container = document.createElement('div');
        container.style.display = 'flex';
        container.style.alignItems = 'center';
        container.style.flexDirection = 'column';
        container.style.padding = '20px';

        // If type is 'whatsapp', create the WhatsApp share button
        if (type === 'whatsapp') {
            const button = document.createElement('img');
            button.src = imageSrc;
            button.width = 50;
            button.alt = text;
            button.style.cursor = 'pointer';
            container.appendChild(button);

            const buttonText = document.createElement('span');
            buttonText.innerText = text;
            container.appendChild(buttonText);

            const spinner = document.createElement('img');
            spinner.src = "img/loading_01.gif";
            spinner.alt = "Carregando...";
            spinner.style.display = 'none';
            spinner.id = `whatsapp-spinner-${index+1}`;
            spinner.width = 30;
            container.appendChild(spinner);

            button.onclick = () => {
                showSpinner(spinner.id);
                uploadAndShare('image' + (index+1), spinner.id);
            };
        } 
        // Otherwise, if type is 'analysis', create the analysis options form
        else if (type === 'analysis') {
            // Analysis options will be a form with radio buttons and a slider
            const form = document.createElement('form');
            form.id = `analysis-options-${index}`;
            form.style.display = 'flex';
            form.style.flexDirection = 'column';
            form.style.alignItems = 'flex-start';
            form.style.marginTop = '10px';

            // Radio buttons for analysis type
            const types = ['t√©cnica', 'descontra√≠da', 'zoeira'];
            types.forEach((type, idx) => {
                const label = document.createElement('label');
                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.name = `analysisType-${index}`;
                radio.value = type;
                radio.id = `analysisType-${type}-${index}`;
                if (idx === 0) radio.checked = true; // Default to first option
                label.appendChild(radio);
                label.appendChild(document.createTextNode(type.charAt(0).toUpperCase() + type.slice(1)));
                form.appendChild(label);
            });

            // Slider for randomness
            const sliderLabel = document.createElement('label');
            sliderLabel.innerText = 'Aleatoriedade:';
            const slider = document.createElement('input');
            slider.type = 'range';
            slider.min = '0';
            slider.max = '1';
            slider.step = '0.1';
            slider.value = '0.1'; // Default value
            slider.id = `randomness-slider-${index}`;
            sliderLabel.appendChild(slider);
            form.appendChild(sliderLabel);

            // Button to trigger the analysis
            const analyzeButton = document.createElement('button');
            analyzeButton.id = `analyze${index}`
            analyzeButton.type = 'button'; // Prevent form submission
            analyzeButton.innerText = text;
            analyzeButton.disabled = true
            analyzeButton.onclick = () => {
                const selectedType = document.querySelector(`input[name="analysisType-${index}"]:checked`).value;
                const randomnessValue = slider.value;
                console.log('Start analysis with options:', selectedType, randomnessValue);
                analyzeAndShare('image' + (index + 1), selectedType, randomnessValue, `analysis-spinner-${index+1}`);
            };
            form.appendChild(analyzeButton);

            container.appendChild(form);
        }

        return { container };
    }


    // Helper function to create radio button
    function createRadioButton(id, value, isChecked) {
        const radioInput = document.createElement('input');
        radioInput.type = 'radio';
        radioInput.id = id;
        radioInput.name = `analysisType-${id.split('-')[2]}`;
        radioInput.value = value;
        radioInput.checked = isChecked;

        const radioLabel = document.createElement('label');
        radioLabel.htmlFor = id;
        radioLabel.innerText = value.charAt(0).toUpperCase() + value.slice(1); // Capitalize the first letter

        radioLabel.appendChild(radioInput);

        return { label: radioLabel };
    }

    async function analyzeAndShare(imageId, analysisType, temperature, spinnerId) {
      trackEvent('clicked_analyzeAndShare', 'Form', 'Clicked analyseAndShare', 1);
      const imageNumber = parseInt(imageId.replace(/[^\d]/g, ''), 10);
      if(imageNumber > 1) {
        alert('N√£o implementado, confira novamente amanh√£');
        return;
      }
      const formData = new FormData(document.getElementById('uploadForm'));
      try {
        start_game()
        const canvasGameContainer = document.getElementById('canvas');
        canvasGameContainer.style.display = 'block';
        const temp = parseFloat(temperature)

        // Append the analysis type and temperature to the formData
        formData.append('data', JSON.stringify({
          type: analysisType,
          temperature: temp
        }));

        let _url;

        if (imageNumber === 1) {
          _url = 'https://api.analisegrupal.com.br/whatsapp/message/avg_sentiment_per_person/analyse'
        }

        const response = await fetch(_url, {
          method: 'POST',
          body: formData
        });

        // Check if the request was successful
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        // Parse the response as JSON
        const result = await response.json();

        // Log the result or do something with it
        // console.log(result);

        uploadAndShare(imageId, spinnerId, result, analysisType, temperature, true)

      } catch (error) {
        console.error('Error during the API call:', error);
      } finally {
        // doSomething???
      }
    }


      function processEndpoint(index, formData) {
          if (index >= endpoints.length) {
            enableAllAnalyzeButtons();
            return; // All endpoints processed
          }

          const endpoint = endpoints[index];
          const resultsDiv = document.getElementById('analysisResults');

          const title = document.createElement('h3');
          let parts = endpoint.split('/');
          let endpointKey = parts.slice(-2).join('/');
          let titleText = endpointTitles[endpointKey] || "Unknown";
          title.innerText = titleText;
          resultsDiv.appendChild(title);

          // Create a container for each set of buttons and their respective spinner and text
          const buttonSetContainer = document.createElement('div');
          buttonSetContainer.style.display = 'flex';
          buttonSetContainer.style.alignItems = 'center';
          buttonSetContainer.style.justifyContent = 'space-between';
          buttonSetContainer.style.marginBottom = '10px'; // Space between button sets

          // Create the WhatsApp share button set
          const whatsappButtonSet = createButtonSet('img/share_whatsapp.png', 'Compartilhe', index, 'whatsapp');
          buttonSetContainer.appendChild(whatsappButtonSet.container);

          // Create the analysis and share button set
          const analysisButtonSet = createButtonSet('img/share_whatsapp.png', 'Analise e Compartilhe', index, 'analysis');
          buttonSetContainer.appendChild(analysisButtonSet.container);

          if (endpoint === "/whatsapp/message/topic_modeling") {
              const placeholderImg = document.createElement('img');
              placeholderImg.src = "img/loading.gif";
              placeholderImg.width = 100;
              resultsDiv.appendChild(placeholderImg);

              fetchData(endpoint, formData)
              .then(htmlContent => {
                  const iframeContainer = document.createElement('div');
                  iframeContainer.style.display = 'flex';
                  iframeContainer.style.justifyContent = 'center';
                  iframeContainer.style.alignItems = 'center';
                  iframeContainer.style.height = '900px';  // Set to the desired height
                  iframeContainer.style.width = '1200px';

                  const iframe = document.createElement('iframe');
                  // iframe.width = "90%";  // Adjust width as needed
                  iframe.height = "100%";  // Use 100% to occupy the full height of the container

                  iframeContainer.appendChild(iframe);
                  resultsDiv.appendChild(iframeContainer);
                  iframe.width = "100%";  // or any other percentage or fixed value that looks better

                  iframe.contentWindow.document.open();
                  iframe.contentWindow.document.write(htmlContent);
                  iframe.contentWindow.document.close();
                  
                  // Remove or hide the placeholder image after the content is loaded
                  resultsDiv.removeChild(placeholderImg);

                  iframe.onload = () => iframe.scrollIntoView({ behavior: 'smooth' }); 

                  processEndpoint(index + 1, formData);  // Process the next endpoint
              })
              .catch(error => {
                  console.error('Error fetching the content:', error);
                  const errorDiv = document.createElement('div');
                  errorDiv.innerHTML = "<p>Error loading content</p>";
                  resultsDiv.appendChild(errorDiv);

                  resultsDiv.removeChild(placeholderImg);

                  processEndpoint(index + 1, formData);  // Process the next endpoint
              });
          } else {
              const img = document.createElement('img');
              img.id = 'image' + (index + 1);
              img.alt = title.innerText;
              img.width = 100;
              img.src = "img/loading.gif";
              resultsDiv.appendChild(img);

              fetchData(endpoint, formData)
              .then(imageBlob => {
                  const imageUrl = URL.createObjectURL(imageBlob);
                  img.width = 1200;
                  img.src = imageUrl;
                  img.onload = () => img.scrollIntoView({ behavior: 'smooth' });

                  // Append the button sets to the resultsDiv
                  resultsDiv.appendChild(buttonSetContainer);

                  processEndpoint(index + 1, formData);  // Process the next endpoint
              })
              .catch(error => {
                  console.error('Error fetching the image:', error);
                  img.width = 100;
                  img.src = "img/error.gif";

                  processEndpoint(index + 1, formData);  // Process the next endpoint
              });
          }
      }

      function submitForm() {
          var fileInput = document.getElementById('file');
          var file = fileInput.files[0];
          var resultsDiv = document.getElementById('analysisResults');
          resultsDiv.innerHTML = "";  // Clear previous results

          // Check if the file extension is .txt or .zip
          var validExtensions = /(\.txt|\.zip)$/i;
          if (!validExtensions.exec(file.name)) {
              alert('Tipo de arquivo inv√°lido. Fa√ßa upload de um arquivo .txt ou .zip.');
              return false;  // Stop the form submission
          }

          var formData = new FormData(document.getElementById('uploadForm'));

          trackEvent('submit', 'Form', 'Chat Upload', 1);
          gtag('submit', 'Form', {'send_to': 'AW-11398970229/w499CJ7ZufMYEPX2ubsq'});
          gtag('event', 'conversion', {'send_to': 'AW-11398970229/xvhrCJKA4fMYEPX2ubsq'});

          processEndpoint(0, formData);  // Start processing from the first endpoint

          return false;  // Prevent actual form submission
      }

      function prepareForAnalysis() {
        let gallery = $('.gallery a').simpleLightbox();
        gallery.on('show.simplelightbox', function () {
          // do something‚Ä¶
        });
      }

      var canvas = document.getElementById("canvas");
      var ctx = canvas.getContext("2d");
      var dir, score, snake, food;
      var speed = 222;
      var speedSnake = 20;

      // Touch control setup
      var touchZone = {
        left: { x: 0, y: canvas.height / 2, width: canvas.width / 4, height: canvas.height / 4 },
        up: { x: canvas.width / 4, y: 0, width: canvas.width / 2, height: canvas.height / 4 },
        right: { x: canvas.width - canvas.width / 4, y: canvas.height / 2, width: canvas.width / 4, height: canvas.height / 4 },
        down: { x: canvas.width / 4, y: canvas.height - canvas.height / 4, width: canvas.width / 2, height: canvas.height / 4 }
      };

      function getTouchPos(canvasDom, touchEvent) {
        var rect = canvasDom.getBoundingClientRect();
        return {
          x: touchEvent.touches[0].clientX - rect.left,
          y: touchEvent.touches[0].clientY - rect.top
        };
      }

      function handleTouch(e) {
        var touchPos = getTouchPos(canvas, e);
        for (var direction in touchZone) {
          var zone = touchZone[direction];
          if (
            touchPos.x > zone.x &&
            touchPos.x < zone.x + zone.width &&
            touchPos.y > zone.y &&
            touchPos.y < zone.y + zone.height
          ) {
            if (direction == "left" && dir != "right") {
              dir = "left";
            } else if (direction == "up" && dir != "down") {
              dir = "up";
            } else if (direction == "right" && dir != "left") {
              dir = "right";
            } else if (direction == "down" && dir != "up") {
              dir = "down";
            }
            break;
          }
        }
        e.preventDefault(); // Prevent scrolling when touching the canvas
      }

      canvas.addEventListener("touchstart", handleTouch, false);

      // Original keyboard controls
      document.addEventListener("keydown", function(e) {
        var keyCode = e.keyCode;
        if (keyCode == 37 && dir != "right") {
          dir = "left";
        }
        if (keyCode == 38 && dir != "down") {
          dir = "up";
        }
        if (keyCode == 39 && dir != "left") {
          dir = "right";
        }
        if (keyCode == 40 && dir != "up") {
          dir = "down";
        }
      });

      setInterval(draw, speed);

      function start_game() {
        var canvasGameContainer = document.getElementById('canvas');
        canvasGameContainer.style.display = 'block';
      }

      function end_game() {
        var canvasGameContainer = document.getElementById('canvas');
        canvasGameContainer.style.display = 'none';
      }

      function init() {
        dir = "right";
        score = 0;
        snake = [{ x: 40, y: 40 }, { x: 60, y: 40 }, { x: 80, y: 40 }];
        createFood();
      }

      function add() {
        var lastsnake = snake[snake.length - 1];

        if (dir == "right") {
          snake.push({ x: lastsnake.x + speedSnake, y: lastsnake.y });
        }
        if (dir == "down") {
          snake.push({ x: lastsnake.x, y: lastsnake.y + speedSnake });
        }
        if (dir == "left") {
          snake.push({ x: lastsnake.x - speedSnake, y: lastsnake.y });
        }
        if (dir == "up") {
          snake.push({ x: lastsnake.x, y: lastsnake.y - speedSnake });
        }
      }

      function createFood() {
        food = {
          x: Math.floor(Math.random() * 25),
          y: Math.floor(Math.random() * 25)
        };
        for (var i = 0; i < snake.length; i++) {
          var snake2 = snake[i];
          if (food.x == snake2.x && food.y == snake2.y) {
            createFood();
          }
        }
      }

      function draw() {
        ctx.clearRect(0, 0, 888, 555);
        snake.shift();
        add();

        var lastsnake = snake[snake.length - 1];
        
        if (lastsnake.x == food.x * 20 && lastsnake.y == food.y * 20) {
          score += 5;
          add();
          createFood();
        }

        for (i = 0; i < snake.length; i++) {
          snake2 = snake[i];
          if (i == snake.length - 1) {
            ctx.fillStyle = "#83a41a";
          } else {
            ctx.fillStyle = "#b4ce3a";
          }
          if (snake2.x > 640) {
            snake2.x = 0;
          }
          if (snake2.x < 0) {
            snake2.x = 640;
          }
          if (snake2.y > 480) {
            snake2.y = 0;
          }
          if (snake2.y < 0) {
            snake2.y = 480;
          }

          if (
            snake2.x == lastsnake.x &&
            snake2.y == lastsnake.y &&
            i < snake.length - 2
          ) {
            alert("Fim de jogo, sua pontua√ß√£o foi: " + score);
            init();
          }

          ctx.fillRect(snake2.x, snake2.y, 19, 19);
        }
        ctx.fillRect(food.x * 17, food.y * 20, 19, 19);
        ctx.fillText("Pontos: " + score, 10, 20);
      }
      requestAnimationFrame(init);
  </script>
  <a href="https://github.com/fcavalcantirj/analise-grupal-html" style="position: absolute; top: 0; right: 0; z-index: 100;">
    <img decoding="async" width="149" height="149" src="https://github.blog/wp-content/uploads/2008/12/forkme_right_orange_ff7600.png?resize=149%2C149" class="attachment-full size-full" alt="Fork me on GitHub" loading="lazy" data-recalc-dims="1">
  </a>
    <footer>
    <p>&copy; 2023 Analise Grupal. Todos os direitos reservados.</p>
  </footer>
</body>

</html>
